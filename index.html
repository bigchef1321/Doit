<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>To do list</title>

<style>
:root{
  --bg:#f2f2f7;
  --card:#ffffff;
  --text:#111111;
  --muted:#8e8e93;
  --accent:#4f5d50;
  --danger:#ff3b30;
  --radius:14px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",sans-serif;
  background:var(--bg);
  color:var(--text);
  overflow-x:hidden;
}

header{
  padding:20px;
  font-size:28px;
  font-weight:700;
}

.container{padding:0 16px 120px 16px; max-width:700px; margin:auto; position:relative}

.page{
  position:absolute;
  width:100%;
  top:0;
  left:0;
  transition:transform 0.35s ease, opacity 0.25s ease;
}

.hidden{opacity:0; pointer-events:none; transform:translateX(30px)}
.active{opacity:1; pointer-events:auto; transform:translateX(0)}

.list-item{
  background:var(--card);
  padding:16px;
  border-radius:var(--radius);
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border:1px solid #A3CF33;
}

.title{font-size:17px; font-weight:500}
.subtitle{font-size:13px; color:var(--muted); margin-top:4px}

.badge{
  font-size:11px;
  padding:4px 8px;
  border-radius:999px;
  background:#bed17f;
  color:var(--accent);
}

.fab{
  position:fixed;
  bottom:30px;
  right:20px;
  width:56px;
  height:56px;
  border-radius:50%;
  background:var(--accent);
  color:white;
  font-size:28px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:20px;
  margin-bottom:16px;
  border:1px solid #e5e5ea;
}

input,textarea,select{
  width:100%;
  padding:14px;
  margin-top:14px;
  border-radius:12px;
  border:1px solid #e5e5ea;
  font-size:16px;
}

textarea{resize:vertical}

.file-buttons{
  display:flex;
  gap:10px;
  margin-top:14px;
}

.file-buttons button{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:1px solid #e5e5ea;
  background:#fafafa;
}

.primary{
  background:var(--accent);
  color:white;
  border:none;
  padding:14px;
  width:100%;
  border-radius:12px;
  font-size:16px;
  margin-top:20px;
}

.secondary{
  background:none;
  border:none;
  color:var(--danger);
  font-size:15px;
  margin-top:14px;
}

.images{
  display:flex;
  gap:10px;
  overflow-x:auto;
  margin-top:15px;
}
.images img{height:120px; border-radius:12px}

.back{color:var(--accent); font-size:16px; margin-bottom:15px; display:inline-block}

</style>
</head>
<body>

<header>To do list</header>

<div class="container">

<div id="pageList" class="page active"></div>
<div id="pageDetail" class="page hidden"></div>
<div id="pageForm" class="page hidden"></div>

</div>

<div class="fab" onclick="openForm()">+</div>

<script>
let tasks=JSON.parse(localStorage.getItem('tasks'))||[];

function saveStorage(){localStorage.setItem('tasks',JSON.stringify(tasks));}

function switchPage(showId){
  document.querySelectorAll('.page').forEach(p=>{
    p.classList.remove('active');
    p.classList.add('hidden');
  });
  const page=document.getElementById(showId);
  page.classList.remove('hidden');
  setTimeout(()=>page.classList.add('active'),10);
}

function renderList(){
  const page=document.getElementById('pageList');
  page.innerHTML='';

  tasks.forEach(t=>{
    const div=document.createElement('div');
    div.className='list-item';
    div.onclick=()=>openDetail(t.id);

    div.innerHTML=`
      <div>
        <div class="title">${t.title}</div>
        <div class="subtitle">${t.dueDate||''}</div>
      </div>
      <div class="badge">${label(t.status)}</div>
    `;

    page.appendChild(div);
  });
}

function label(s){return s==='todo'?'À faire':s==='doing'?'En cours':'Terminée';}

function openDetail(id){
  const t=tasks.find(t=>t.id===id);
  const page=document.getElementById('pageDetail');

  page.innerHTML=`
    <div class="back" onclick="switchPage('pageList')">← Retour</div>
    <div class="card">
      <h2>${t.title}</h2>
      <div class="badge">${label(t.status)}</div>
      <p>${t.description||''}</p>
      ${t.dueDate?`<div class="subtitle">Échéance : ${t.dueDate}</div>`:''}
      <div class="images">${(t.images||[]).map(i=>`<img src="${i}">`).join('')}</div>
      <button class="primary" onclick="openForm('${t.id}')">Modifier</button>
      <button class="secondary" onclick="deleteTask('${t.id}')">Supprimer</button>
    </div>
  `;

  switchPage('pageDetail');
}

function openForm(id=null){
  const page=document.getElementById('pageForm');
  let t={title:'',description:'',dueDate:'',status:'todo',images:[]};
  if(id){t=tasks.find(x=>x.id===id)}

  page.innerHTML=`
    <div class="back" onclick="switchPage('pageList')">← Retour</div>
    <div class="card">
      <input type="hidden" id="editId" value="${id||''}">
      <input type="text" id="title" placeholder="Titre" value="${t.title||''}">
      <textarea id="description" placeholder="Description">${t.description||''}</textarea>
      <input type="date" id="dueDate" value="${t.dueDate||''}">
      <select id="status">
        <option value="todo" ${t.status==='todo'?'selected':''}>À faire</option>
        <option value="doing" ${t.status==='doing'?'selected':''}>En cours</option>
        <option value="done" ${t.status==='done'?'selected':''}>Terminée</option>
      </select>

      <div class="file-buttons">
        <button onclick="document.getElementById('fileInput').click()">Ajouter fichiers</button>
        <button onclick="document.getElementById('cameraInput').click()">Prendre photo</button>
      </div>

      <input type="file" id="fileInput" accept="image/*" multiple hidden>
      <input type="file" id="cameraInput" accept="image/*" capture="environment" multiple hidden>

      <button class="primary" onclick="saveTask()">Valider</button>
    </div>
  `;

  switchPage('pageForm');
}

function saveTask(){
  const id=document.getElementById('editId').value;
  const title=document.getElementById('title').value.trim();
  if(!title)return;

  const description=document.getElementById('description').value;
  const dueDate=document.getElementById('dueDate').value;
  const status=document.getElementById('status').value;

  const files=[
    ...document.getElementById('fileInput').files,
    ...document.getElementById('cameraInput').files
  ];

  const processImages=(callback)=>{
    if(!files.length)return callback([]);
    let imgs=[]; let loaded=0;
    files.forEach(f=>{
      const r=new FileReader();
      r.onload=e=>{imgs.push(e.target.result);loaded++;if(loaded===files.length)callback(imgs)};
      r.readAsDataURL(f);
    });
  };

  processImages((newImgs)=>{
    if(id){
      const t=tasks.find(t=>t.id===id);
      t.title=title;
      t.description=description;
      t.dueDate=dueDate;
      t.status=status;
      t.images=[...(t.images||[]),...newImgs];
    }else{
      tasks.push({id:crypto.randomUUID(),title,description,dueDate,status,images:newImgs});
    }

    saveStorage();
    renderList();
    switchPage('pageList');
  });
}

function deleteTask(id){
  tasks=tasks.filter(t=>t.id!==id);
  saveStorage();
  renderList();
  switchPage('pageList');
}

renderList();
</script>
</body>
</html>
